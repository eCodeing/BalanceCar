#include "hmi.h"

const unsigned char sinecode[] = 
{
0x7F,0x85,0x8B,0x92,0x98,0x9E,0xA4,0xAA,0xB0,0xB6,0xBB,0xC1,0xC6,0xCB,0xD0,0xD5
,0xD9,0xDD,0xE2,0xE5,0xE9,0xEC,0xEF,0xF2,0xF5,0xF7,0xF9,0xFB,0xFC,0xFD,0xFE,0xFE
,0xFE,0xFE,0xFE,0xFD,0xFC,0xFB,0xF9,0xF7,0xF5,0xF2,0xEF,0xEC,0xE9,0xE5,0xE2,0xDD
,0xD9,0xD5,0xD0,0xCB,0xC6,0xC1,0xBB,0xB6,0xB0,0xAA,0xA4,0x9E,0x98,0x92,0x8B,0x85
,0x7F,0x79,0x73,0x6C,0x66,0x60,0x5A,0x54,0x4E,0x48,0x43,0x3D,0x38,0x33,0x2E,0x29
,0x25,0x21,0x1C,0x19,0x15,0x12,0x0F,0x0C,0x09,0x07,0x05,0x03,0x02,0x01,0x00,0x00
,0x00,0x00,0x00,0x01,0x02,0x03,0x05,0x07,0x09,0x0C,0x0F,0x12,0x15,0x19,0x1C,0x21
,0x25,0x29,0x2E,0x33,0x38,0x3D,0x43,0x48,0x4E,0x54,0x5A,0x60,0x66,0x6C,0x73,0x79	
};

void HMI_SendEOF(void)
{
	while((USART2->SR&0X40)==0);
	 USART_SendData(USART2,0xff);
	while((USART2->SR&0X40)==0);
	 USART_SendData(USART2,0xff);
	while((USART2->SR&0X40)==0);
	 USART_SendData(USART2,0xff);
}
void HMI_SendData(char* buf)
{
	UART2_SendData(buf);
	HMI_SendEOF();
}
void HMI_DisplayInfo(void)
{
	uint8_t buf[20];
	sprintf(buf,"j0.val=%d",processbar);
	HMI_SendData(buf);
	memset(buf,0,sizeof(buf));
//	sprintf(buf,"t1.txt=\"%d\"",processbar);
	sprintf(buf,"t1.txt=\"%d%%\"",processbar);
	HMI_SendData(buf);
}
void HMI_DisplaySine(void)
{
	uint8_t buf_temp[20];
	uint8_t ch0,ch1;
	int i,j = 32;
	for(i = 0;i < sizeof(sinecode);i++)
	{
		ch0 = sinecode[i]/3+40;
		ch1 = sinecode[j++]/3+40;
		if(j>=sizeof(sinecode))
			j = 0;
		snprintf(buf_temp,sizeof(buf_temp),"add 1,0,%d",ch0);
		HMI_SendData(buf_temp);
		snprintf(buf_temp,sizeof(buf_temp),"add 1,1,%d",ch1);
		HMI_SendData(buf_temp);
	}
}

